
https://mp.weixin.qq.com/s/zStHPv6tI-Y_NrdppefYBw

## 1、智能网卡发展背景

网卡（Network Interface Card，简称NIC）是将电脑接入局域网的设备，网卡插在计算机主板的总线插槽中，负责将用户要传递的数据转换为网络设备能够识别的格式，通过网络介质传输。

智能网卡（Smart NIC），也称智能网络适配器，除了能完成标准网卡所具有的网络传输功能之外，还提供内置的可编程、可配置的硬件加速引擎，提升应用的性能和大幅降低CPU在通信中的消耗，为应用提供更多的CPU资源。  

例如，在高度虚拟化的环境中，主机CPU需要运行OVS（Open Virtual Switch）相关任务，同时CPU还要处理存储、数据包的在线加解密或离线加解密、数据包深度检查、防火墙、复杂路由等操作，这些操作不仅消耗大量的CPU资源，同时由于不同业务之间的CPU资源争夺，导致业务的性能不能发挥到最佳。网卡作为连接各种业务的枢纽，在网卡上对于上述业务进行加速，成为了最理想的场所。

智能网卡的出现，为解决这个问题提供了新的思路，我们可以通过智能网卡来将OVS操作从CPU卸载下来，并完成存储加速、数据加密、深度包检测和复杂路由等各种功能，将花费在处理这些工作负载上的大量的CPU周期返回给主机CPU，同时解决了不同业务之间的冲突问题，大幅提升了各项业务的性能，也确保了服务器CPU能为应用提供最大的处理能力或者提供更多的虚拟机（VM）服务，创造更大的价值。

## 2、网卡及智能网卡技术简介  

**（1）网卡架构技术特点**

网卡的架构如图所示，一个典型的NIC由一个处理网络流量的处理器、一对处理数据移动的DMA引擎和一个用于缓冲区和Doorbell的本地存储器（通常是RAM）组成。

![](images/Pasted%20image%2020221221190357.png)

**（2）智能网卡架构技术特点**  

智能网卡是具有独立的计算单元，能完成特定的基础设施功能操作的网卡，如智能网卡可完成特定的重组加速、安全加速等操作，相对于普通网卡可以带来较大的性能提升。智能网卡上的可编程ASIC或FPGA单元有可以运行自定义软件的计算层，计算层可以为网络流量提供服务，并可以执行特定网络及数据。

中心基础设施功能，还为外部网络和服务器OS之间提供了额外的安全层（也就是将安全保障由ToR交换机转移向了该设备）。

![](images/Pasted%20image%2020221221190420.png)

**（3）各种智能网卡实现的技术要点对比**  

目前的智能网卡有ASIC、FPGA和片上系统（SoC）三种实现。

![](images/Pasted%20image%2020221221190431.png)

**（4）网卡与智能网卡的性能对比（如表2所示）**

![](images/Pasted%20image%2020221221190440.png)
![](images/Pasted%20image%2020221221190450.png)
![](images/Pasted%20image%2020221221190502.png)

不同实现方式的智能网卡在成本、编程的简易性和灵活性方面存在各种权衡。ASIC非常具有成本效益，可以提供最佳的性价比，但它的灵活性受ASIC中定义的功能的限制。基于FPGA智能网卡则可以在可用逻辑门约束范围内，花费足够的时间和成本来相对有效地支持几乎任何功能。但FPGA编程简易性较差且价格昂贵。对于更复杂的、更广泛的用例，基于SoC（如NVIDIA的BlueField DPU）提供了最佳的智能网卡实施选项：良好的性价比、易于编程且高度灵活。

![](images/Pasted%20image%2020221221190516.png)

## 3.智能网卡的优劣势分析

智能网卡为数据中心网络提供了几项重要优势，包括：
  
1)对于运营大型数据中心的公共云服务提供商而言，智能网卡可以释放CPU核来为最终用户运行业务应用程序，从而可能实现更高的服务器利用率。
  
2)各 种 基 础 设 施 操 作 卸 载 。例 如 R D M A 融 合 以 太 网 ( Ro C E ) 、 传 输 控 制 协 议 （ TC P ） 、 N V M e -oF（NVMe-over-Fabrics）、互联网安全协议（IPSec）、安全传输层协议（TLS）、深度报文检测（DPI）、OVS（Open Virtual Switch）等。
  
3)某些类别的智能网卡是可编程的，可以针对广泛的应用程序进行定制，并且可以重新组装以满足新的要求。
  
智能网卡并非没有缺点，在智能网卡被更广泛的采用之前，需要解决以下问题：
  
1)与标准网卡相比，智能网卡的价格显着溢价。考虑到相同的端口速度，溢价可能会影响智能网卡的普及，尤其是在批量生产时需要降低价格。

2)智能网卡的功耗较普通网卡高，一般20W~80W，随着更多功能的集成，功耗也会越来越高。

3)鉴于智能网卡上支持的功能越来越多，其可编程性和复杂性也越来越高，它们可能会消耗大量工程资源来进行开发和调试，从而导致实施时间长且成本高。基于以上考虑，主要的云服务提供商和网卡供应商已经基于不同的解决方案开发了智能网卡：基于ARM的SoC、FPGA和定制ASIC。这些解决方案中的每一个都提供不同程度的卸载和可编程性，

在智能网卡发展的过程中，智能网卡升级为DPU（Data Processing Unit）。DPU延续了智能网卡的基本功能，并将通用工作任务做了加速处理。如图4所示，相比智能网卡在数据层面上实现加速，DPU的最大的区别是能在实现智能网卡的功能的基础之上实现控制面的加速。

![](images/Pasted%20image%2020221221190611.png)




