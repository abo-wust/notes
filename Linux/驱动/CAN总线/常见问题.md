## 1 CAN标识符、过滤器、屏蔽器之间的关系
* **问题 1**
	看了好多遍数据，也没搞明白 CAN 的标识符、CAN 接收过滤器和 CAN 接收屏蔽器之间有什么关系， 单独看都明白，一旦联系起来就胡涂了。在一个主控制器对多点通讯网络中，它们各自如何配置，主机要 想发信息给所有的从机，和主机想发信息给某个特定的从机，应该怎么配置这几个寄存器？
* **解答 1**
	CAN节点通过标识符来识别CAN帧是不是自己想要的,识别方法就是通过滤波屏蔽寄存器的设置来完 成,接收滤波寄存器设置了标识符每位的值,接收屏蔽寄存器一般有相同的数量匹配接收滤波寄存器,规定接 收滤波寄存器标识符每一位的值是否需要进行匹配,比如芯片设置有6个接收滤波寄存器和6个接收屏蔽寄 存器,从总线上接收 CAN 帧,然后依次将收到的 CAN 帧标识符与 6 对接收滤波和屏蔽寄存器进行匹配,符合 某对接收滤波和屏蔽寄存器要求了,就停止匹配,将数据接收到对应的缓冲区中。
	
	例如：设置某接收滤波寄存器 00000000001（11 位），接收屏蔽寄存器 11111111101（11 位），则该对 组合会拒绝接收 00000000011 和 00000000001 之外所有的标识符对应的 CAN 帧，因为屏蔽器规定第二位 （为 0）以外的所有标识符位要严格匹配（与滤波器值一致），第二位的滤波器值和收到的 CAN 标识符第 二位值是否一致都可以。
	
	不同的芯片滤波屏蔽寄存器的运行方式不太一致,至少我用过的 AT90CAN128 和 MCP2515 差别就很大, 不过原理都一样。

* **问题 2**
	初学 CAN 的朋友应该都会遇到我这样的问题，我的理解是，一个节点向网络中发送一条信息，所有的节点都能收到，收到后每个节点将收到的标识符自行与自己的比较，符合的才接收，过滤器和屏蔽器决 定标识符中哪些位参与比较，也就是说有些位可以不参与比较就直接接收，这很有用，比如，11 位的标识 符不可能都用来标识下位机号，你一个网络不可能连接那么多节点，11 位的标识符有点浪费，我们可以将 最高 3 位用来表示所发送的数据类型，在接收点设置滤波器和屏蔽器只比较节点号部分，先将数据接收下 来，在将最高 3 位拿来判断是什么数据，我的试验结果是 RXB0SIDH 会被发送端的 TXB0SIDH 修改，判 断 RXB0SIDH 的最高三位即可知道接收的数据类型。
* **解答 2**
	
	理解正确。
	
	如果不做这个硬件滤波，也可以使用软件来解析地址，决定是否需要处理收到的报文，不过这就会增 加 CPU 的开销，所以，合理的设定硬件的 `mask & filter`，可以节省很多 CPU 时间。

## 2 CAN发送问题
* **问题 1**
	两个 CAN 节点通信，一方发送，一方接收。发送方如果没有收到接收方的应答，一直就会处于发送状态，程序会死在那里，跳不出来。
* **解答 1**
	两种方法：
	* 设置一个等待时间，自开始发送起，等待时间到了以后，取消发送。
	* 置起发送位后，不需要等待是否发送成功，去干其它事，程序就不会死在这里了。

* **问题 2**
	应答是 CAN 的底层协议吗？置起发送位后。发送方的 CAN 控制器自身是不是要等待接收方的控制器的 应答。就是我问的 CAN 的应答机制。是不是它的底层协议。如果收不到应答，CAN 就会死在那里？？
	问题已经解决：在每次发完后，再对 CAN 进行下软件复位。
* **解答 2**
	一般的做法是：
	* 填好数据，置起发送位；
	* 去做其它事，到要发送下一笔前，来检查上一次是否已经发送完；
	* 如果上一笔没有发送完，则决定如何处理：取消发送，或是等待。

## 3 超过八个字节如何发送
* **问题 1**
	需要一起发送超过八个字节的 数据，但是 SJA1000 的一次最多只能发送八个字节的数据。如何能一次发送超过八个字节的数据？
* **解答 1**
	分片发送，接收重组。


## 4 can的几个概念
### 主动错误
主动错误(Error active)：当报文在网络上传输时，接受节点检测网络上有错误产生，而不是自己产生的错误时，就认为是主动错误，这时，节点会发出连续的 6 个显性位，连续的 6 个显性位会在网络上产生填充错误，导致网络上所有的节点都会收到此错误，从而将当前正在传送的报文丢掉。

### 被动错误
被动错误(Error passive)：节点检测到自己出现了错误，而不是网络上的错误，这为被动错误。此时，节点会发出连续的 6 个隐性位，同样产生填充错误，但此错误帧不会影响网络上其它的节点接收数据，除非 此节点为发送报文的节点。

### 位定时
？？？

## 5 上位机的 ID怎么定
* **问题**
	现在我想要用 PLC（上位机）控制 5 台变频器（下位机），关于上位机的 ID 我不知道怎么定义，因为采 用 CAN 是标准帧格式，11 位 ID 这样规定的下位机发送 ID：
	1000 0000 002-》PLC 读取下位机 1 的信息
	1000 0000 003-》PLC 读取下位机 2 信息
	1000 0000 004-》PLC 读取下位机 3 信息
	1000 0000 005-》PLC 读取下位机 4 信息
	1000 0000 006-》PLC 读取下位机 5 信息
	
	不明白的地方：
	1) 下位机怎么向上位机发送信息，它又不会自己主动发，是靠 PLC 先发送指令给下位机，下位机再用相 同的 ID 把自己的数据传上去吗？
	2) 上位机的 ID 可怎么定义啊？CAN 总线在传输时，节点受到的是数据，这节点 11 位标识符不能作为数 据吧？
	 如果 PLC 的 ID 定义为 1000 0000 002（举例），那其它的下位机发送的信息它怎么收的到呢？
	 如果屏蔽掉最后一位，不做比较，凡是 1000 0000 00X 的节点发过来的信息照单全收，它又如何知道是哪个节点发过来的信息？

