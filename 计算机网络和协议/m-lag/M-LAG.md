

https://info.support.huawei.com/info-finder/encyclopedia/zh/M-LAG.html

https://support.huawei.com/enterprise/zh/doc/EDOC1100138437/76a57c68

M-LAG最佳实现
https://support.huawei.com/enterprise/zh/doc/EDOC1000137637/be250e81

https://support.huawei.com/enterprise/zh/doc/EDOC1000137637/426cffd9

如何从堆叠切换为M-LAG
https://support.huawei.com/enterprise/zh/doc/EDOC1100143453/50a5f546#ZH-CN_TOPIC_0279116016


## 堆叠与M-LAG的区别

| | 堆叠 | M-LAG |
|----|---------|----------|
| 虚拟系统的IP | 堆叠设备组有统一的IP地址。堆叠生效后各成员自己的IP地址失效。| M-LAG设备组成员有各自的IP地址。M-LAG设备组没有统一的IP地址。 |
| 虚拟系统的MAC| 堆叠设备组有统一的MAC地址。堆叠生效后各成员自己的MAC地址失效。| M-LAG设备组成员有各自的MAC地址。M-LAG设备组没有统一的MAC地址。|
| 设备登录| 所有设备相当于一台设备，登录设备组中任意一台设备均相当登录主设备。| 所有设备独立，各设备仍有独立的管理网口。|
| 双主检测链路| 业务口直连；Eth-Trunk口代理；管理网口检测| 三层可达的链路|
| 状态协商 | 通过iStack链路传递报文。| 通过peer-link链路传递Hello报文、设备信息报文。|
| 可检测的故障| 直连链路故障；堆叠系统成员设备故障；iStack链路故障；堆叠端口故障| 直连链路故障；M-LAG成员设备故障；Peer-link链路故障；接口故障|


## 堆叠、M-LAG的优劣势对比

| | 堆叠| M-LAG |
|---|---|---|
| 可靠性 | 一般：控制面集中，故障可能在成员设备上扩散。主设备的故障可能影响成员设备，可靠性一般。| 较高：控制面独立，故障域隔离。|
| 成本 | 一般：需部署堆叠线缆。| 一般：需部署Peer-link线缆。|
| 配置复杂度 | 简单：逻辑上为一台设备，多台设备同时配置。| 正常：多台设备独立配置。|
| 扩展能力 | 一般：控制面的能力局限于主设备的能力。| 较强：扩展能力不受单台设备限制。|
| 对业务的影响 | 升级：业务20秒~1分钟的中断。扩容：三台设备以上扩容时需改变原有网络架构或重启设备，影响现有业务。| 升级：流量秒级中断。扩容：不改变原有网络架构，不影响现有业务。|
| 升级复杂度 | 高：通过堆叠快速升级可以降低业务中断时间，但升级操作时间变长，升级风险变高。| 低：通过reboot升级，操作简单，风险低。|
| 网络设计 | 相对简单：逻辑上单节点设计。| 相对复杂：逻辑上双节点设计。|


## 总结

堆叠具有配置、设计相对简单的优点，但灵活度、可靠性、升级复杂程度均不如M-LAG；M-LAG相比于堆叠虽然配置复杂度较高，但其控制面解耦、组网灵活度高的特点使其可靠性更强。


