
SBFD简介：更适合SR隧道

BFD进行大量链路检测时，其状态机的协商时间会变长，不适合Segement Routing。

SBFD（Seamless Bidirectional Forwarding Detection）是BFD的一种简化机制，它简化了BFD的状态机，缩短了协商时间，提高了整个网络的灵活性，能够支撑SR隧道检测。

![](images/Pasted%20image%2020230426104535.png)

反射端没有状态机机制，仅做反射

多个检测端可以共用一个反射端

1.1 SBFD工作原理：

![500](images/Pasted%20image%2020230426105230.png)

1. 在链路检测前，两端互相发送SBFD控制报文通告SBFD描述信息。
2. 链路检测时，发起端主动发送SBFD Echo报文，反射端根据本端情况环回此报文。发起端根据反射报文决定本端状态。

- 发起端状态机只有Up和Down状态，发出的报文也只有Up和Down状态，只能接收Up或Admin Down状态报文。

SBFD报文由发起端首先向反射端发送，报文初始状态为Down。报文目的端口号为7784，报文的源端口号为4784，目的IP为用户配置的127网段的任意IP地址，源IP地址为本端设备上配置的LSR ID。

- 反射端无SBFD状态机，无检测机制，不会主动发送SBFD Echo报文，仅用于构造环回SBFD报文。反射端所构造报文的目的端口号为4784，报文的源端口号为7784，源IP地址为本端设备配置的LSR ID，目的IP为发起端的源IP地址。

1.2 单臂BFD检测

- BFD和SBFD均需要两端设备支持此功能。在特定场景下要与不支持BFD的设备对接时，华为设备支持配置BFD单臂功能（也称为单臂Echo功能） 。通过在支持BFD功能的设备上创建单臂Echo功能的BFD会话，不支持BFD功能的设备接收到该BFD报文后，直接将该报文环回，从而达到快速检测链路的目的。
- 单臂Echo不需要双方协商Echo能力，一端配置BFD检测，另一端无需有BFD能力。使能单臂Echo的设备发送特殊的BFD报文（IP头中的源和目的IP都是本端设备的IP地址，BFD报文中的本地标识和远端标识相同）。对端收到后直接环回到本端，以此判断链路是否正常，有很强的适配能力。

![](images/Pasted%20image%2020230426105355.png)



