
## 08-01

### 工作内容

1. 721-6C48整机测试问题单对齐，遗留高温不通问题，常温不通的问题硬件今天没有环境进行复现，需要协调；
2. 硬件没有环境验证self-checking的改动，本地721环境使用未修改的sdk版本，插三个光模块和一个电模块用PC打流复现self-checking导致收包fcs问题，脚本测试600次命令未出现收包fcs；
3. 启动打印ctc_port_led_api_set错误问题，返回的是芯片没有使用的接口，驱动没有做错误码区分，不是初始化功能问题。

### 问题



## 08-02

### 工作内容

1. 上午和下午完成线上培训考试；
2. 721满带宽配置打流丢包，原因是1.05GHz主频下最大支持1.1T流量，而24个10G口，24个25G口和6个100G口满带宽时转发流量达到1.44T超过芯片限制，所以丢包；
3. 版本验证bug修改ITS00310898，ITS00310895、ITS00310897

### 问题



## 08-03

### 工作内容

1. 721低温启动业务不通，原因还是mac rx disable，加的规避线程确实在运行，可能是进入规避过程的判断条件和88A不一样，等再复现时确认；
2. 熟悉芯片的转发流程：接口配置不同的vlan，打不同类型报文时抓取pkt-trace，8180的转发流程比88E设备的内容要多，不同配置下的表项处理有不同，后续继续对比熟悉；

### 问题



## 08-04

### 工作内容

1. 721-C低温启动业务不通，原因与之前不同，今天发现port-en是disable状态的；
2. 定位mac rx disable规避未生效问题时发现用来记录端口linkstatus的全局变量m_pulLsLinkStatus状态不对，port-en disable的端口记录的值为0，导致该端口没有进入规避流程；

### 问题



## 08-07

### 工作内容

1. 定位port-en非使能问题，主要是启动过程中linkstatus的状态变化，增加log梳理状态变化逻辑。link的状态是根据端口mac-en加los一起判断的，启动过程中已经读到mac-en使能时，后续再次读取是disable，震荡多次后恢复稳定，而出问题的可能就是震荡后没有恢复正常。
2. 修改验证paf文件，上周回归未通过，中间git的提交有点问题，熟悉了一下git的分支操作。

### 问题



## 08-08

### 工作内容

1. 梳理分析代码，启动过程中端口link状态的处理，主要是配置port-en和mac-en的地方；
2. 初始化的状态都是正常，之前看到的up/down震荡是因为端口初始化配置速率和双工模式要先disable mac-en，再enable mac-en，并且中间有10ms的延时，而linkscan的周期是8ms，所以会检测到down/up，这个过程最后会恢复稳定，但是不通的时候确实是linkstatus值不对，所以还是要加log复现来确定。

### 问题



## 08-09

### 工作内容

1. 梳理分析代码，启动过程中端口link状态的处理；
2. 温箱环境复现问题，低温启动32次复现一次，高温启动复现两次，串口日志明天分析；
3. self-checking端口仍然会导致收包全部fcs。

### 问题



## 08-10

### 工作内容

1. 分析上电不通的串口日志，发现三个问题：
    （1）设置端口速率和双工会先disable mac-en，设置之后会重新enable，不通时后一次的enable没有中断上报到软件注册的中断处理函数（log没有加在入口处，也可能是上报了但是参数异常）；

    （2）up/down的中断正常，但是读sfp的los信号返回down，导致软件link状态未更新，这个熊奥斯分析可能确实是cpld和sdk协商的结果就是down；

    （3）异常的端口会在其他所有口up后再打印一次平台的up信息，但是在加的log里面没找到对应的记录，需要确认是哪里报给平台的。

### 问题



## 08-11

### 工作内容

1. 721上电不通问题：修改代码，比如端口速率配置时加的mac-en操作以及延时，尝试提高复现概率，接10个串连模块反复上电没有复现，可能是串联数量不够，无法验证修改；
2. 杨勇答复以前的SDK会在port-en disable的时候关闭中断，导致mac enable时没有link中断，但是8180没有这个部分，怀疑是延续下来的问题，需要复现确认异常端口的中断计数是否增加。

### 问题



## 08-14

### 工作内容

1. 721上电不通问题规避，新起一个任务定时校验port-en和mac-en，如果mac-en和sfp_los都是link，而port-en是disable，则重新使能一下port-en，上一个新增的规避mac rx disable的任务继续保留，以免出现88-A一样的问题。

### 问题



## 08-15

### 工作内容

1. 721上电不通问题规避方法验证，今天复现两次，规避手段正常恢复端口，业务正常能通；
2. 修改代码，尝试提高复现频率，没有作用；跟踪sdk里面中断计数，试着在mac disable和enable前后增加日志，看是否正常计数，未找到合适方法。

### 问题



## 08-16

### 工作内容

1. 解决bug ITS00309993和ITS00311568：show manufacture info显示的设备信息需要在shell下用btest工具写入，或者在boot下写入后才能读出结果；
2. 增加风扇版本显示，熟悉获取风扇信息的一些接口，比如转速、档位等，以及ros平台输出格式内容的方法等。

### 问题



## 08-17

### 工作内容

1. linkup中断上报问题，在mac-en前后加的读取中断计数没有作用，杨勇给了一个怀疑的方向，sdk为防止端口up/down震荡加了一个16ms的防抖过滤，不知道有没有效果，暂时还没复现；
2. 之前发现的sdk代码改动编译没有效果，原因是没有正常编译出结果，需要先clean一下sdk，然后重新编译，耗时较长。
### 问题



## 08-18

### 工作内容

1. linkup中断上报问题，sdk为防止端口up/down震荡加了一个16ms的防抖过滤，去掉这个之后上电37次，仍出现一次异常，频次没有明显变化；
2. 解决721-4C24后8个端口不link问题，原因是发光使能配置的寄存器地址错误；
3. 721-4C24中间8个口插千兆模块不link的现象，在机房设备上掉电10次没有复现，等刘攀环境空了再看看。

### 问题



## 08-21

### 工作内容

1. 解决721-4C24设备6口插千兆电模块不link问题，原因是识别电模块需要先读取6口发光使能的寄存器，而代码中6口的读取出现错误，导致模块类型识别失败；
2. 721-4C24中间8个口插千兆模块不link的现象，在升级解决最后8个口不link问题的版本后正常，可能是后8个口的发光使能地址影响，具体原因未找到。

### 问题



## 08-22

### 工作内容

1. 编写VLAN/QINQ的PPT文档。
### 问题



## 08-23

### 工作内容

1. 定位721C-4C24设备system灯不亮，以及电源风扇灯点反的问题，软件设置值都正确，cpld寄存器地址都正确，最后发现原因是指示灯的丝印反了，snmp灯的问题也是这原因；
2. 编写培训PPT文档，完成培训。

### 问题



## 08-24

### 工作内容

1. 4C24的test all测试没有风扇电源插满的环境，但是其他项都正常没有错误；
2. 修改6C48验证sfp的test命令，编译的版本出现之前bsp报错的打印，更新到最新代码，clean所有选项后重新编译仍然存在，最后发现是编译脚本被改回去了。

### 问题



## 08-25

### 工作内容

1. 修改test all命令未插风扇时返回结果pass，调用的函数直接返回OK，没有区分正确和错误情况；
2. 修改diag test fan命令插风扇报错，测试档位错误。

### 问题



## 08-28

### 工作内容

1. sdk端口link的中断计数，之前在mac-en前后分别读取，发现没有显示实际值，今天在其他地方加日志也没有正确抓到计数，应该是保存中断的全局变量在sdk里面回调层数过多，加日志读取的地方还没来得及更新计数；
2. 6C48和4C24在同一目录下编译时只rbsp clean没有用，升级后仍然报i2c错误，需要all clean后重新编译。

### 问题



## 08-29

### 工作内容

1. sdk端口link的中断计数不准确，用脚本反复快速配置mac disable/enable也能复现port-en非使能，但是中断计数不准确，与杨勇沟通是sdk可能会有漏处理，具体待fae后续反馈；
2. 反复上电复现port-en时发现部分端口会因为平台oam link事件发送的强制发送命令，触发驱动层的link状态更新，从而重新使能port-en，只有1/3/2-1/3/7口。

### 问题



## 08-30

### 工作内容

1. 定位反复上电复现port-en时，异常的接口会最后上报一次up事件到平台，加日志定位，是接口link事件的处理函数在收消息队列超时后会轮询所有接口状态，读一次sfp的los，与保存的状态不一致会重新使能port-en，然后触发link事件上报平台。这个逻辑一直存在，但是之前硬件测试复现时并没有触发使能port-en，现在的版本不需要规避手段，通过这个逻辑也能恢复正常，查看最近的代码提交没有相关改动。

### 问题


## 08-31

### 工作内容

1. 梳理接口管理和聚合口的link处理逻辑，包括平台的事件通知流程和驱动的事件和快速通知逻辑。驱动层是没有震荡抑制的，在接口管理模块实现。
    根据之前邮件的内容和初步定位，可能不是震荡抑制的原因，因为show显示物理口是up，应该是lacp这边的bPortDisable成员置位异常，导致显示为down，具体等明天测试升级版本后复现分析日志。

### 问题

